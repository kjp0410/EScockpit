<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工单管理 - 分布式储能系统</title>
    <!-- 
        注意: cdn.tailwindcss.com 不应在生产环境中使用。
        在生产环境中使用 Tailwind CSS，请将其安装为 PostCSS 插件或使用 Tailwind CLI。
        详情参考: https://tailwindcss.com/docs/installation
    -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* 确保html和body可以滚动 */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: auto; /* 允许滚动 */
        }
        
        /* 主容器样式 */
        .main-container {
            min-height: 100vh; /* 至少占满视口高度 */
            position: relative;
            overflow-y: auto; /* 允许垂直滚动 */
        }
        
        /* 内容区域调整 */
        .content-container {
            position: absolute;
            top: 64px; /* 顶部导航栏高度 */
            left: 240px; /* 侧边栏宽度 */
            right: 0;
            bottom: 0;
            overflow-y: auto;
            padding: 20px;
            background-color: #f9fafb;
        }
        
        /* 侧边栏调整 */
        aside {
            position: fixed; /* 固定定位，不随页面滚动 */
            top: 64px; /* 顶部导航栏高度 */
            left: 0;
            bottom: 0;
            width: 240px;
            overflow-y: auto; /* 允许垂直滚动 */
            z-index: 10;
        }
        
        /* 顶部导航栏调整 */
        header {
            position: fixed; /* 固定定位，不随页面滚动 */
            top: 0;
            left: 0;
            right: 0;
            height: 64px;
            z-index: 20;
        }
        
        /* 移动设备布局调整 */
        @media (max-width: 767px) {
            .content-container {
                left: 0; /* 在移动设备上隐藏侧边栏 */
            }
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        
        .glass-card {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 12px;
        }
        
        .sidebar-item {
            transition: all 0.2s ease;
        }
        
        .sidebar-item:hover:not(.active) {
            background-color: rgba(243, 244, 246, 0.8);
        }
        
        .sidebar-item.active {
            background-color: rgba(59, 130, 246, 0.1);
            color: rgb(59, 130, 246);
            font-weight: 500;
        }
        
        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .submenu.open {
            max-height: 200px;
        }
        
        .nav-item {
            position: relative;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            transition: all 0.2s ease;
        }
        
        .nav-item:hover:not(.active) {
            background-color: rgba(243, 244, 246, 0.8);
        }
        
        .nav-item.active {
            color: rgb(59, 130, 246);
            font-weight: 500;
        }
        
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            text-align: center;
            white-space: nowrap;
        }
        
        .status-critical {
            background-color: rgba(239, 68, 68, 0.1);
            color: rgb(239, 68, 68);
        }
        
        .status-warning {
            background-color: rgba(245, 158, 11, 0.1);
            color: rgb(245, 158, 11);
        }
        
        .status-normal {
            background-color: rgba(16, 185, 129, 0.1);
            color: rgb(16, 185, 129);
        }
        
        .status-info {
            background-color: rgba(59, 130, 246, 0.1);
            color: rgb(59, 130, 246);
        }
        
        /* 表格样式 */
        .ticket-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .ticket-table th {
            background-color: #f9fafb;
            font-weight: 500;
            text-align: left;
            padding: 0.75rem 1rem;
            font-size: 0.75rem;
            color: #6b7280;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .ticket-table td {
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .ticket-table tr:hover {
            background-color: #f9fafb;
        }
        
        /* 时间线样式 */
        .timeline {
            position: relative;
            padding-left: 1.5rem;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0.5rem;
            width: 2px;
            background-color: #e5e7eb;
        }
        
        .timeline-item {
            position: relative;
            padding-bottom: 1.5rem;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            top: 0.25rem;
            left: -1.5rem;
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 50%;
            background-color: #3b82f6;
        }
        
        /* 开关样式 */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 36px;
            height: 20px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #3b82f6;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(16px);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="main-container">
        <!-- 顶部导航栏 -->
        <header class="bg-white shadow-sm fixed top-0 left-0 right-0 z-20">
            <div class="max-w-full mx-auto px-4">
                <div class="flex items-center justify-between h-16">
                    <!-- 左侧Logo和站点切换 -->
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <img class="h-8 w-auto" src="2.png" alt="Logo">
                        </div>
                        <div class="ml-4 flex items-center md:ml-6">
                            <div class="text-sm font-medium text-gray-700">分布式储能管理系统</div>
                        </div>
                    </div>
                    
                    <!-- 中间导航菜单 -->
                    <div class="hidden md:flex md:items-center md:justify-center md:flex-1">
                        <nav class="flex flex-wrap justify-center space-x-1 sm:space-x-2 md:space-x-4 lg:space-x-10">
                            <a href="#" class="nav-item text-xs sm:text-sm font-medium py-1 px-1 border-b-2 border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300 transition-colors">
                                <span>驾驶舱</span>
                            </a>
                            <a href="#" class="nav-item text-xs sm:text-sm font-medium py-1 px-1 border-b-2 border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300 transition-colors">
                                <span>站点列表</span>
                            </a>
                            <a href="#" class="nav-item text-xs sm:text-sm font-medium py-1 px-1 border-b-2 border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300 transition-colors">
                                <span>告警中心</span>
                            </a>
                            <a href="#" class="nav-item text-xs sm:text-sm font-medium py-1 px-1 border-b-2 border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300 transition-colors">
                                <span>消息通知</span>
                            </a>
                        </nav>
                    </div>
                    
                    <!-- 右侧图标区域 -->
                    <div class="hidden md:flex items-center space-x-4 pr-2 sm:pr-4 md:pr-6 lg:pr-8">
                        <a href="#" class="text-gray-600 hover:text-gray-900 transition-colors">
                            <i class="fas fa-cog text-lg"></i>
                            <span class="sr-only">管理</span>
                        </a>
                        <a href="#" class="text-gray-600 hover:text-gray-900 transition-colors">
                            <i class="fas fa-user-circle text-lg"></i>
                            <span class="sr-only">我的</span>
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- 左侧子导航菜单 -->
        <aside class="fixed left-0 top-16 bottom-0 w-60 bg-white shadow-sm z-10 overflow-y-auto" id="sidebar">
            <nav class="py-4">
                <div class="sidebar-item px-4 py-3 flex items-center space-x-3">
                    <i class="fas fa-home text-lg w-6"></i>
                    <span>站点概况</span>
                </div>
                
                <div class="sidebar-parent">
                    <div class="sidebar-item px-4 py-3 flex items-center justify-between cursor-pointer" id="battery-management">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-battery-three-quarters text-lg w-6"></i>
                            <span>电池管理</span>
                        </div>
                        <i class="fas fa-chevron-down text-sm transition-transform" id="battery-chevron"></i>
                    </div>
                    <div class="submenu pl-10" id="battery-submenu">
                        <div class="sidebar-item px-4 py-2 flex items-center space-x-3">
                            <i class="fas fa-bolt text-sm w-5"></i>
                            <span class="text-sm">PCS</span>
                        </div>
                        <div class="sidebar-item px-4 py-2 flex items-center space-x-3">
                            <i class="fas fa-cubes text-sm w-5"></i>
                            <span class="text-sm">电池包</span>
                        </div>
                    </div>
                </div>
                
                <div class="sidebar-item px-4 py-3 flex items-center space-x-3">
                    <i class="fas fa-chart-line text-lg w-6"></i>
                    <span>收益报表</span>
                </div>
                
                <div class="sidebar-item px-4 py-3 flex items-center space-x-3">
                    <i class="fas fa-calendar-alt text-lg w-6"></i>
                    <span>业务调度日历</span>
                </div>
                
                <div class="sidebar-item px-4 py-3 flex items-center space-x-3">
                    <i class="fas fa-exclamation-triangle text-lg w-6"></i>
                    <span>站点报警</span>
                </div>
                
                <div class="sidebar-item active px-4 py-3 flex items-center space-x-3">
                    <i class="fas fa-clipboard-list text-lg w-6"></i>
                    <span>工单管理</span>
                </div>
                
                
                <div class="sidebar-item px-4 py-3 flex items-center space-x-3">
                    <i class="fas fa-desktop text-lg w-6"></i>
                    <span>数据监控</span>
                </div>
            </nav>
        </aside>

        <!-- 主内容区域 -->
        <div class="content-container">
            <!-- 工单概览 -->
            <div class="mb-6">
                <h1 class="text-xl font-semibold text-gray-800 mb-4">工单管理</h1>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <!-- 待处理工单 -->
                    <div class="bg-white rounded-lg shadow-sm p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-sm text-gray-500 mb-1">待处理工单</div>
                                <div class="text-2xl font-semibold">24</div>
                            </div>
                            <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
                                <i class="fas fa-clipboard-list text-blue-500"></i>
                            </div>
                        </div>
                        <div class="mt-2 text-xs">
                            <span class="text-red-500">
                                <i class="fas fa-arrow-up mr-1"></i>8.2%
                            </span>
                            <span class="text-gray-500 ml-1">较上周</span>
                        </div>
                    </div>
                    
                    <!-- 处理中工单 -->
                    <div class="bg-white rounded-lg shadow-sm p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-sm text-gray-500 mb-1">处理中工单</div>
                                <div class="text-2xl font-semibold">18</div>
                            </div>
                            <div class="w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center">
                                <i class="fas fa-tools text-yellow-500"></i>
                            </div>
                        </div>
                        <div class="mt-2 text-xs">
                            <span class="text-green-500">
                                <i class="fas fa-arrow-down mr-1"></i>3.1%
                            </span>
                            <span class="text-gray-500 ml-1">较上周</span>
                        </div>
                    </div>
                    
                    <!-- 已完成工单 -->
                    <div class="bg-white rounded-lg shadow-sm p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-sm text-gray-500 mb-1">已完成工单</div>
                                <div class="text-2xl font-semibold">156</div>
                            </div>
                            <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center">
                                <i class="fas fa-check-circle text-green-500"></i>
                            </div>
                        </div>
                        <div class="mt-2 text-xs">
                            <span class="text-green-500">
                                <i class="fas fa-arrow-up mr-1"></i>12.5%
                            </span>
                            <span class="text-gray-500 ml-1">较上周</span>
                        </div>
                    </div>
                    
                    <!-- 超时工单 -->
                    <div class="bg-white rounded-lg shadow-sm p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-sm text-gray-500 mb-1">超时工单</div>
                                <div class="text-2xl font-semibold">5</div>
                            </div>
                            <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center">
                                <i class="fas fa-clock text-red-500"></i>
                            </div>
                        </div>
                        <div class="mt-2 text-xs">
                            <span class="text-red-500">
                                <i class="fas fa-arrow-up mr-1"></i>2.0%
                            </span>
                            <span class="text-gray-500 ml-1">较上周</span>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <!-- 工单趋势图 -->
                    <div class="bg-white rounded-lg shadow-sm p-4 md:col-span-2">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-base font-medium text-gray-800">工单趋势</h2>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 text-xs bg-blue-500 text-white rounded">日</button>
                                <button class="px-3 py-1 text-xs bg-gray-100 text-gray-500 rounded">周</button>
                                <button class="px-3 py-1 text-xs bg-gray-100 text-gray-500 rounded">月</button>
                            </div>
                        </div>
                        <div class="h-64">
                            <canvas id="ticketTrendChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- 工单分类饼图 -->
                    <div class="bg-white rounded-lg shadow-sm p-4">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-base font-medium text-gray-800">工单分类</h2>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 text-xs bg-blue-500 text-white rounded">类型</button>
                                <button class="px-3 py-1 text-xs bg-gray-100 text-gray-500 rounded">优先级</button>
                            </div>
                        </div>
                        <div class="h-64">
                            <canvas id="ticketCategoryChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 工单列表 -->
            <div class="bg-white rounded-lg shadow-sm p-4">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-base font-medium text-gray-800">工单列表</h2>
                    <div>
                        <button id="create-ticket-btn" class="px-3 py-1.5 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600">
                            <i class="fas fa-plus mr-1"></i>创建工单
                        </button>
                        <button id="auto-rule-btn" class="ml-2 px-3 py-1.5 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200">
                            <i class="fas fa-cog mr-1"></i>自动规则
                        </button>
                    </div>
                </div>
                
                <div class="flex flex-wrap items-center gap-2 mb-4">
                    <div class="relative">
                        <input type="text" placeholder="搜索工单..." class="pl-8 pr-4 py-1.5 text-sm border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500">
                        <i class="fas fa-search text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2"></i>
                    </div>
                    <select class="text-sm border rounded-md px-2 py-1.5">
                        <option>全部站点</option>
                        <option>北京朝阳储能电站</option>
                        <option>上海浦东储能电站</option>
                        <option>广州天河储能电站</option>
                    </select>
                    <select class="text-sm border rounded-md px-2 py-1.5">
                        <option>全部类型</option>
                        <option>设备故障</option>
                        <option>系统维护</option>
                        <option>巡检</option>
                        <option>其他</option>
                    </select>
                    <select class="text-sm border rounded-md px-2 py-1.5">
                        <option>全部优先级</option>
                        <option>紧急</option>
                        <option>高</option>
                        <option>中</option>
                        <option>低</option>
                    </select>
                    <select class="text-sm border rounded-md px-2 py-1.5">
                        <option>全部状态</option>
                        <option>待处理</option>
                        <option>处理中</option>
                        <option>已完成</option>
                        <option>已关闭</option>
                    </select>
                    <div class="relative">
                        <input type="date" class="text-sm border rounded-md px-2 py-1.5">
                    </div>
                    <button class="px-3 py-1.5 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600">
                        <i class="fas fa-filter mr-1"></i>筛选
                    </button>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="ticket-table">
                        <thead>
                            <tr>
                                <th>工单ID</th>
                                <th>关联告警</th>
                                <th>工单类型</th>
                                <th>站点</th>
                                <th>设备</th>
                                <th>优先级</th>
                                <th>状态</th>
                                <th>创建时间</th>
                                <th>处理人</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>TK-20230615-001</td>
                                <td>
                                    <a href="#" class="text-blue-500 hover:underline">ALM-20230615-001</a>
                                </td>
                                <td>设备故障</td>
                                <td>北京朝阳储能电站</td>
                                <td>电池包 #B-12</td>
                                <td><span class="status-badge status-critical">紧急</span></td>
                                <td><span class="status-badge status-warning">处理中</span></td>
                                <td>2023-06-15 14:35:22</td>
                                <td>张工程师</td>
                                <td>
                                    <button class="text-blue-500 hover:text-blue-700 mr-2" onclick="showTicketDetail('TK-20230615-001')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="text-gray-500 hover:text-gray-700">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>TK-20230615-002</td>
                                <td>
                                    <a href="#" class="text-blue-500 hover:underline">ALM-20230615-003</a>
                                </td>
                                <td>系统维护</td>
                                <td>上海浦东储能电站</td>
                                <td>PCS #P-05</td>
                                <td><span class="status-badge status-warning">高</span></td>
                                <td><span class="status-badge status-info">待处理</span></td>
                                <td>2023-06-15 15:12:45</td>
                                <td>李工程师</td>
                                <td>
                                    <button class="text-blue-500 hover:text-blue-700 mr-2" onclick="showTicketDetail('TK-20230615-002')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="text-blue-500 hover:text-blue-700">
                                        <i class="fas fa-play"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>TK-20230614-005</td>
                                <td>
                                    <span class="text-gray-500">-</span>
                                </td>
                                <td>巡检</td>
                                <td>广州天河储能电站</td>
                                <td>全站</td>
                                <td><span class="status-badge status-normal">中</span></td>
                                <td><span class="status-badge status-normal">已完成</span></td>
                                <td>2023-06-14 09:30:15</td>
                                <td>王工程师</td>
                                <td>
                                    <button class="text-blue-500 hover:text-blue-700 mr-2" onclick="showTicketDetail('TK-20230614-005')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="text-gray-300 cursor-not-allowed">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>TK-20230614-003</td>
                                <td>
                                    <a href="#" class="text-blue-500 hover:underline">ALM-20230614-002</a>
                                </td>
                                <td>设备故障</td>
                                <td>深圳南山储能电站</td>
                                <td>BMS #BMS-03</td>
                                <td><span class="status-badge status-warning">高</span></td>
                                <td><span class="status-badge status-normal">已完成</span></td>
                                <td>2023-06-14 11:45:33</td>
                                <td>赵工程师</td>
                                <td>
                                    <button class="text-blue-500 hover:text-blue-700 mr-2" onclick="showTicketDetail('TK-20230614-003')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="text-gray-300 cursor-not-allowed">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>TK-20230613-008</td>
                                <td>
                                    <span class="text-gray-500">-</span>
                                </td>
                                <td>系统维护</td>
                                <td>北京朝阳储能电站</td>
                                <td>PCS #P-02</td>
                                <td><span class="status-badge status-info">低</span></td>
                                <td><span class="status-badge status-critical">超时</span></td>
                                <td>2023-06-13 16:20:45</td>
                                <td>未分配</td>
                                <td>
                                    <button class="text-blue-500 hover:text-blue-700 mr-2" onclick="showTicketDetail('TK-20230613-008')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="text-orange-500 hover:text-orange-700">
                                        <i class="fas fa-user-plus"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="flex justify-between items-center mt-4">
                    <div class="text-sm text-gray-500">
                        显示 1 至 5 条，共 24 条
                    </div>
                    <div class="flex space-x-1">
                        <button class="px-3 py-1 text-sm border rounded-md bg-white text-gray-500 hover:bg-gray-50">上一页</button>
                        <button class="px-3 py-1 text-sm border rounded-md bg-blue-500 text-white">1</button>
                        <button class="px-3 py-1 text-sm border rounded-md bg-white text-gray-500 hover:bg-gray-50">2</button>
                        <button class="px-3 py-1 text-sm border rounded-md bg-white text-gray-500 hover:bg-gray-50">3</button>
                        <button class="px-3 py-1 text-sm border rounded-md bg-white text-gray-500 hover:bg-gray-50">4</button>
                        <button class="px-3 py-1 text-sm border rounded-md bg-white text-gray-500 hover:bg-gray-50">5</button>
                        <button class="px-3 py-1 text-sm border rounded-md bg-white text-gray-500 hover:bg-gray-50">下一页</button>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- 工单详情弹窗 -->
    <div id="ticket-detail-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 class="text-lg font-medium">工单详情</h3>
                <button id="close-detail-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <div class="mb-4">
                            <h4 class="text-sm font-medium text-gray-500 mb-1">工单ID</h4>
                            <p id="detail-ticket-id" class="text-base">TK-20230615-001</p>
                        </div>
                        <div class="mb-4">
                            <h4 class="text-sm font-medium text-gray-500 mb-1">工单类型</h4>
                            <p class="text-base">设备故障</p>
                        </div>
                        <div class="mb-4">
                            <h4 class="text-sm font-medium text-gray-500 mb-1">站点</h4>
                            <p class="text-base">北京朝阳储能电站</p>
                        </div>
                        <div class="mb-4">
                            <h4 class="text-sm font-medium text-gray-500 mb-1">设备</h4>
                            <p class="text-base">电池包 #B-12</p>
                        </div>
                    </div>
                    <div>
                        <div class="mb-4">
                            <h4 class="text-sm font-medium text-gray-500 mb-1">优先级</h4>
                            <p><span class="status-badge status-critical">紧急</span></p>
                        </div>
                        <div class="mb-4">
                            <h4 class="text-sm font-medium text-gray-500 mb-1">状态</h4>
                            <p><span class="status-badge status-warning">处理中</span></p>
                        </div>
                        <div class="mb-4">
                            <h4 class="text-sm font-medium text-gray-500 mb-1">创建时间</h4>
                            <p class="text-base">2023-06-15 14:35:22</p>
                        </div>
                        <div class="mb-4">
                            <h4 class="text-sm font-medium text-gray-500 mb-1">处理人</h4>
                            <p class="text-base">张工程师</p>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h4 class="text-sm font-medium text-gray-500 mb-1">工单描述</h4>
                    <p class="text-base">电池包 #B-12 温度异常，超过设定阈值。需要立即检查冷却系统和电池状态，防止安全事故。</p>
                </div>
                
                <div class="mb-4">
                    <h4 class="text-sm font-medium text-gray-500 mb-1">关联告警</h4>
                    <div class="bg-gray-50 p-3 rounded-md">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="text-sm font-medium">ALM-20230615-001</p>
                                <p class="text-xs text-gray-500">电池温度过高告警</p>
                            </div>
                            <span class="status-badge status-critical">紧急</span>
                        </div>
                        <p class="text-sm mt-2">电池包 #B-12 温度达到 45°C，超过安全阈值 (40°C)</p>
                        <p class="text-xs text-gray-500 mt-1">2023-06-15 14:30:15</p>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h4 class="text-sm font-medium text-gray-500 mb-2">处理记录</h4>
                    <div class="relative">
                        <div class="absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200"></div>
                        
                        <div class="relative pl-10 pb-6">
                            <div class="absolute left-0 top-1.5 w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center">
                                <i class="fas fa-plus"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium">工单创建</p>
                                <p class="text-xs text-gray-500">系统自动 · 2023-06-15 14:35:22</p>
                                <p class="text-sm mt-1">基于告警 ALM-20230615-001 自动创建工单</p>
                            </div>
                        </div>
                        
                        <div class="relative pl-10 pb-6">
                            <div class="absolute left-0 top-1.5 w-8 h-8 rounded-full bg-yellow-500 text-white flex items-center justify-center">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium">工单分配</p>
                                <p class="text-xs text-gray-500">系统自动 · 2023-06-15 14:36:05</p>
                                <p class="text-sm mt-1">工单已分配给张工程师</p>
                            </div>
                        </div>
                        
                        <div class="relative pl-10 pb-6">
                            <div class="absolute left-0 top-1.5 w-8 h-8 rounded-full bg-green-500 text-white flex items-center justify-center">
                                <i class="fas fa-tools"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium">开始处理</p>
                                <p class="text-xs text-gray-500">张工程师 · 2023-06-15 14:50:33</p>
                                <p class="text-sm mt-1">已到达现场，开始检查冷却系统</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h4 class="text-sm font-medium text-gray-500 mb-2">添加处理记录</h4>
                    <div>
                        <textarea class="w-full border rounded-md p-2 text-sm" rows="3" placeholder="输入处理意见..."></textarea>
                        <div class="flex justify-between items-center mt-2">
                            <div>
                                <button class="px-3 py-1.5 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200">
                                    <i class="fas fa-paperclip mr-1"></i>添加附件
                                </button>
                                <select class="ml-2 text-sm border rounded-md px-2 py-1.5">
                                    <option>更新状态</option>
                                    <option>处理中</option>
                                    <option>已完成</option>
                                    <option>已关闭</option>
                                </select>
                            </div>
                            <button class="px-3 py-1.5 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600">
                                提交
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex justify-between p-4 border-t">
                <button id="close-detail-btn" class="px-3 py-1.5 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200">
                    关闭
                </button>
                <div>
                    <button class="px-3 py-1.5 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 mr-2">
                        <i class="fas fa-file-export mr-1"></i>导出报告
                    </button>
                    <button id="handle-ticket-btn" class="px-3 py-1.5 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600">
                        完成工单
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 创建工单弹窗 -->
    <div id="create-ticket-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 class="text-lg font-medium">创建工单</h3>
                <button id="close-create-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">站点</label>
                        <select class="w-full text-sm border rounded-md px-2 py-1.5">
                            <option>选择站点</option>
                            <option>北京朝阳储能电站</option>
                            <option>上海浦东储能电站</option>
                            <option>广州天河储能电站</option>
                            <option>深圳南山储能电站</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">设备</label>
                        <select class="w-full text-sm border rounded-md px-2 py-1.5">
                            <option>选择设备</option>
                            <option>PCS #P-01</option>
                            <option>BMS #BMS-01</option>
                            <option>电池包 #B-01</option>
                            <option>全站</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">工单类型</label>
                        <select class="w-full text-sm border rounded-md px-2 py-1.5">
                            <option>选择类型</option>
                            <option>设备故障</option>
                            <option>系统维护</option>
                            <option>巡检</option>
                            <option>其他</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">优先级</label>
                        <select class="w-full text-sm border rounded-md px-2 py-1.5">
                            <option>选择优先级</option>
                            <option>紧急</option>
                            <option>高</option>
                            <option>中</option>
                            <option>低</option>
                        </select>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">关联告警</label>
                    <select class="w-full text-sm border rounded-md px-2 py-1.5">
                        <option>无关联告警</option>
                        <option>ALM-20230615-001 - 放电电流过大一级报警</option>
                        <option>ALM-20230615-003 - 充电电流过大一级报警</option>
                        <option>ALM-20230614-002 - 单体压差一级报警</option>
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">处理人</label>
                    <select class="w-full text-sm border rounded-md px-2 py-1.5">
                        <option>选择处理人</option>
                        <option>张组长</option>
                        <option>李工程师</option>
                        <option>王工程师</option>
                        <option>赵工程师</option>
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">工单描述</label>
                    <textarea class="w-full border rounded-md p-2 text-sm" rows="4" placeholder="输入工单描述..."></textarea>
                </div>
            </div>
            <div class="flex justify-end p-4 border-t">
                <button id="cancel-create-btn" class="px-3 py-1.5 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 mr-2">
                    取消
                </button>
                <button id="submit-create-btn" class="px-3 py-1.5 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600">
                    创建工单
                </button>
            </div>
        </div>
    </div>
    
    <!-- 自动规则弹窗 -->
    <div id="auto-rule-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-5xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center p-3 border-b">
                <h3 class="text-base font-medium">自动工单规则配置</h3>
                <button id="close-rule-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <div class="flex justify-between items-center mb-3">
                    <div class="text-sm text-gray-500">
                        共 5 条规则
                    </div>
                    <button id="add-rule-btn" class="px-2.5 py-1 text-xs bg-blue-500 text-white rounded-md hover:bg-blue-600">
                        <i class="fas fa-plus mr-1"></i>新增规则
                    </button>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full text-xs border-collapse">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="py-2 px-3 text-left font-medium text-gray-500 border-b">规则名称</th>
                                <th class="py-2 px-3 text-left font-medium text-gray-500 border-b">触发条件</th>
                                <th class="py-2 px-3 text-left font-medium text-gray-500 border-b">工单类型</th>
                                <th class="py-2 px-3 text-left font-medium text-gray-500 border-b">优先级</th>
                                <th class="py-2 px-3 text-left font-medium text-gray-500 border-b">分配规则</th>
                                <th class="py-2 px-3 text-left font-medium text-gray-500 border-b">创建时间</th>
                                <th class="py-2 px-3 text-left font-medium text-gray-500 border-b">状态</th>
                                <th class="py-2 px-3 text-left font-medium text-gray-500 border-b">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b hover:bg-gray-50">
                                <td class="py-2 px-3">电池温度异常告警</td>
                                <td class="py-2 px-3">温度异常告警 & 紧急级别</td>
                                <td class="py-2 px-3">设备故障</td>
                                <td class="py-2 px-3">紧急</td>
                                <td class="py-2 px-3">站点负责人</td>
                                <td class="py-2 px-3">2023-06-10 10:30:15</td>
                                <td class="py-2 px-3">
                                    <label class="inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer" checked>
                                        <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-500"></div>
                                    </label>
                                </td>
                                <td class="py-2 px-3">
                                    <button class="text-blue-500 hover:text-blue-700 mr-2">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="text-red-500 hover:text-red-700">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="border-b hover:bg-gray-50">
                                <td class="py-2 px-3">PCS通信中断</td>
                                <td class="py-2 px-3">通信中断告警 & PCS设备</td>
                                <td class="py-2 px-3">通信故障</td>
                                <td class="py-2 px-3">高</td>
                                <td class="py-2 px-3">轮询分配</td>
                                <td class="py-2 px-3">2023-06-08 15:45:30</td>
                                <td class="py-2 px-3">
                                    <label class="inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer" checked>
                                        <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-500"></div>
                                    </label>
                                </td>
                                <td class="py-2 px-3">
                                    <button class="text-blue-500 hover:text-blue-700 mr-2">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="text-red-500 hover:text-red-700">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="border-b hover:bg-gray-50">
                                <td class="py-2 px-3">每周巡检</td>
                                <td class="py-2 px-3">定时触发 & 每周一</td>
                                <td class="py-2 px-3">巡检</td>
                                <td class="py-2 px-3">中</td>
                                <td class="py-2 px-3">站点负责人</td>
                                <td class="py-2 px-3">2023-06-05 09:15:00</td>
                                <td class="py-2 px-3">
                                    <label class="inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer" checked>
                                        <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-500"></div>
                                    </label>
                                </td>
                                <td class="py-2 px-3">
                                    <button class="text-blue-500 hover:text-blue-700 mr-2">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="text-red-500 hover:text-red-700">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="border-b hover:bg-gray-50">
                                <td class="py-2 px-3">电池SOC过低</td>
                                <td class="py-2 px-3">SOC低于20%告警</td>
                                <td class="py-2 px-3">设备故障</td>
                                <td class="py-2 px-3">高</td>
                                <td class="py-2 px-3">技能匹配</td>
                                <td class="py-2 px-3">2023-06-02 14:20:10</td>
                                <td class="py-2 px-3">
                                    <label class="inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer">
                                        <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-500"></div>
                                    </label>
                                </td>
                                <td class="py-2 px-3">
                                    <button class="text-blue-500 hover:text-blue-700 mr-2">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="text-red-500 hover:text-red-700">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr class="border-b hover:bg-gray-50">
                                <td class="py-2 px-3">月度系统维护</td>
                                <td class="py-2 px-3">定时触发 & 每月1日</td>
                                <td class="py-2 px-3">系统维护</td>
                                <td class="py-2 px-3">中</td>
                                <td class="py-2 px-3">手动分配</td>
                                <td class="py-2 px-3">2023-05-28 11:10:45</td>
                                <td class="py-2 px-3">
                                    <label class="inline-flex items-center cursor-pointer">
                                        <input type="checkbox" class="sr-only peer" checked>
                                        <div class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-500"></div>
                                    </label>
                                </td>
                                <td class="py-2 px-3">
                                    <button class="text-blue-500 hover:text-blue-700 mr-2">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="text-red-500 hover:text-red-700">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- 新增规则弹窗 -->
    <div id="add-rule-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center p-3 border-b">
                <h3 class="text-base font-medium">新增自动工单规则</h3>
                <button id="close-add-rule-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-4">
                <form>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">规则名称</label>
                            <input type="text" class="w-full px-2.5 py-1.5 text-xs border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500" placeholder="输入规则名称">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">触发类型</label>
                            <select id="trigger-type-select" class="w-full px-2.5 py-1.5 text-xs border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500">
                                <option value="alarm">告警触发</option>
                                <option value="scheduled">定时触发</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="block text-xs font-medium text-gray-700 mb-1">触发条件</label>
                        
                        <!-- 告警触发条件 -->
                        <div id="alarm-conditions" class="border rounded-md p-2.5 bg-gray-50">
                            <div class="mb-2.5">
                                <label class="block text-xs text-gray-700 mb-1">告警设备</label>
                                <select class="w-full px-2.5 py-1.5 text-xs border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500">
                                    <option>所有设备</option>
                                    <option>PCS</option>
                                    <option>BMS</option>
                                    <option>电池包</option>
                                    <option>EMS</option>
                                    <option>空调设备</option>
                                </select>
                            </div>
                            <div class="mb-2.5">
                                <label class="block text-xs text-gray-700 mb-1">告警级别</label>
                                <select class="w-full px-2.5 py-1.5 text-xs border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500">
                                    <option>所有级别</option>
                                    <option>紧急</option>
                                    <option>高</option>
                                    <option>中</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs text-gray-700 mb-1">站点</label>
                                <select class="w-full px-2.5 py-1.5 text-xs border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500">
                                    <option>所有站点</option>
                                    <option>北京朝阳储能电站</option>
                                    <option>上海浦东储能电站</option>
                                    <option>广州天河储能电站</option>
                                    <option>深圳南山储能电站</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- 定时触发条件 -->
                        <div id="scheduled-conditions" class="border rounded-md p-2.5 bg-gray-50 hidden">
                            <div class="mb-2.5">
                                <label class="block text-xs text-gray-700 mb-1">周期类型</label>
                                <select id="schedule-type" class="w-full px-2.5 py-1.5 text-xs border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500">
                                    <option value="weekly">每周</option>
                                    <option value="monthly">每月</option>
                                    <option value="yearly">每年</option>
                                </select>
                            </div>
                            <div id="weekly-option" class="mb-2.5">
                                <label class="block text-xs text-gray-700 mb-1">执行日</label>
                                <select class="w-full px-2.5 py-1.5 text-xs border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500">
                                    <option>周一</option>
                                    <option>周二</option>
                                    <option>周三</option>
                                    <option>周四</option>
                                    <option>周五</option>
                                    <option>周六</option>
                                    <option>周日</option>
                                </select>
                            </div>
                            <div id="monthly-option" class="mb-2.5 hidden">
                                <label class="block text-xs text-gray-700 mb-1">执行日</label>
                                <select class="w-full px-2.5 py-1.5 text-xs border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500">
                                    <option>1日</option>
                                    <option>2日</option>
                                    <option>3日</option>
                                    <option>4日</option>
                                    <option>5日</option>
                                    <option>6日</option>
                                    <option>7日</option>
                                    <option>8日</option>
                                    <option>9日</option>
                                    <option>10日</option>
                                    <option>11日</option>
                                    <option>12日</option>
                                    <option>13日</option>
                                    <option>14日</option>
                                    <option>15日</option>
                                    <option>最后一日</option>
                                </select>
                            </div>
                            <div id="yearly-option" class="mb-2.5 hidden">
                                <div class="grid grid-cols-2 gap-2">
                                    <div>
                                        <label class="block text-xs text-gray-700 mb-1">月份</label>
                                        <select class="w-full px-2.5 py-1.5 text-xs border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500">
                                            <option>1月</option>
                                            <option>2月</option>
                                            <option>3月</option>
                                            <option>4月</option>
                                            <option>5月</option>
                                            <option>6月</option>
                                            <option>7月</option>
                                            <option>8月</option>
                                            <option>9月</option>
                                            <option>10月</option>
                                            <option>11月</option>
                                            <option>12月</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-700 mb-1">日期</label>
                                        <select class="w-full px-2.5 py-1.5 text-xs border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500">
                                            <option>1日</option>
                                            <option>2日</option>
                                            <option>3日</option>
                                            <option>4日</option>
                                            <option>5日</option>
                                            <option>6日</option>
                                            <option>7日</option>
                                            <option>8日</option>
                                            <option>9日</option>
                                            <option>10日</option>
                                            <option>11日</option>
                                            <option>12日</option>
                                            <option>13日</option>
                                            <option>14日</option>
                                            <option>15日</option>
                                            <option>最后一日</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs text-gray-700 mb-1">站点</label>
                                <select class="w-full px-2.5 py-1.5 text-xs border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500">
                                    <option>所有站点</option>
                                    <option>北京朝阳储能电站</option>
                                    <option>上海浦东储能电站</option>
                                    <option>广州天河储能电站</option>
                                    <option>深圳南山储能电站</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">工单类型</label>
                            <select class="w-full px-2.5 py-1.5 text-xs border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500">
                                <option>设备故障</option>
                                <option>系统维护</option>
                                <option>巡检</option>
                                <option>其他</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-700 mb-1">优先级</label>
                            <select class="w-full px-2.5 py-1.5 text-xs border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500">
                                <option>紧急</option>
                                <option>高</option>
                                <option>中</option>
                                <option>低</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="block text-xs font-medium text-gray-700 mb-1">分配规则</label>
                        <select class="w-full px-2.5 py-1.5 text-xs border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500">
                            <option>站点负责人</option>
                            <option>轮询分配</option>
                            <option>负载均衡</option>
                            <option>技能匹配</option>
                            <option>手动分配</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label class="block text-xs font-medium text-gray-700 mb-1">规则描述</label>
                        <textarea class="w-full px-2.5 py-1.5 text-xs border rounded-md focus:outline-none focus:ring-1 focus:ring-blue-500" rows="3" placeholder="输入规则描述"></textarea>
                    </div>
                    
                    <div class="flex items-center mb-3">
                        <input type="checkbox" id="rule-enabled" class="w-3.5 h-3.5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <label for="rule-enabled" class="ml-2 text-xs text-gray-700">启用规则</label>
                    </div>
                </form>
            </div>
            <div class="flex justify-end p-3 border-t">
                <button id="cancel-add-rule-btn" class="px-3 py-1.5 text-xs text-gray-700 border rounded-md mr-2 hover:bg-gray-50">取消</button>
                <button id="save-rule-btn" class="px-3 py-1.5 text-xs bg-blue-500 text-white rounded-md hover:bg-blue-600">保存</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化图表
            initCharts();
            
            // 侧边栏子菜单切换
            const submenuToggles = document.querySelectorAll('.submenu-toggle');
            if (submenuToggles.length > 0) {
                submenuToggles.forEach(function(toggle) {
                    toggle.addEventListener('click', function() {
                        const submenuId = this.getAttribute('data-submenu');
                        const submenu = document.getElementById(submenuId);
                        if (submenu) {
                            submenu.classList.toggle('open');
                            const icon = this.querySelector('.fa-chevron-down');
                            if (icon) {
                                icon.style.transform = submenu.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0)';
                            }
                        }
                    });
                });
            }
            
            // 工单详情弹窗
            const viewButtons = document.querySelectorAll('.ticket-table .fa-eye');
            if (viewButtons.length > 0) {
                viewButtons.forEach(function(btn) {
                    btn.parentElement.addEventListener('click', function() {
                        const ticketId = this.getAttribute('onclick').match(/'([^']+)'/)[1];
                        showTicketDetail(ticketId);
                    });
                });
            }
            
            // 关闭工单详情弹窗
            const closeDetailModal = document.getElementById('close-detail-modal');
            if (closeDetailModal) {
                closeDetailModal.addEventListener('click', function() {
                    const modal = document.getElementById('ticket-detail-modal');
                    if (modal) {
                        modal.classList.add('hidden');
                    }
                });
            }
            
            const closeDetailBtn = document.getElementById('close-detail-btn');
            if (closeDetailBtn) {
                closeDetailBtn.addEventListener('click', function() {
                    const modal = document.getElementById('ticket-detail-modal');
                    if (modal) {
                        modal.classList.add('hidden');
                    }
                });
            }
            
            // 检查URL哈希，如果是#create-ticket则打开创建工单弹窗
            if (window.location.hash === '#create-ticket') {
                const createTicketModal = document.getElementById('create-ticket-modal');
                if (createTicketModal) {
                    createTicketModal.classList.remove('hidden');
                }
            }
            
            // 创建工单按钮
            const createTicketBtn = document.getElementById('create-ticket-btn');
            if (createTicketBtn) {
                createTicketBtn.addEventListener('click', function() {
                    const createTicketModal = document.getElementById('create-ticket-modal');
                    if (createTicketModal) {
                        createTicketModal.classList.remove('hidden');
                    }
                });
            }
            
            // 关闭创建工单弹窗
            const closeCreateModal = document.getElementById('close-create-modal');
            const cancelCreateBtn = document.getElementById('cancel-create-btn');
            if (closeCreateModal) {
                closeCreateModal.addEventListener('click', function() {
                    const createTicketModal = document.getElementById('create-ticket-modal');
                    if (createTicketModal) {
                        createTicketModal.classList.add('hidden');
                        // 清除URL哈希
                        if (window.location.hash === '#create-ticket') {
                            history.pushState("", document.title, window.location.pathname + window.location.search);
                        }
                    }
                });
            }
            if (cancelCreateBtn) {
                cancelCreateBtn.addEventListener('click', function() {
                    const createTicketModal = document.getElementById('create-ticket-modal');
                    if (createTicketModal) {
                        createTicketModal.classList.add('hidden');
                        // 清除URL哈希
                        if (window.location.hash === '#create-ticket') {
                            history.pushState("", document.title, window.location.pathname + window.location.search);
                        }
                    }
                });
            }
            
            // 自动规则按钮
            const autoRuleBtn = document.getElementById('auto-rule-btn');
            if (autoRuleBtn) {
                autoRuleBtn.addEventListener('click', function() {
                    const modal = document.getElementById('auto-rule-modal');
                    if (modal) {
                        modal.classList.remove('hidden');
                    }
                });
            }
            
            // 关闭自动规则弹窗
            const closeRuleModal = document.getElementById('close-rule-modal');
            if (closeRuleModal) {
                closeRuleModal.addEventListener('click', function() {
                    const modal = document.getElementById('auto-rule-modal');
                    if (modal) {
                        modal.classList.add('hidden');
                    }
                });
            }
            
            // 点击弹窗外部关闭弹窗
            const ticketDetailModal = document.getElementById('ticket-detail-modal');
            if (ticketDetailModal) {
                ticketDetailModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.add('hidden');
                    }
                });
            }
            
            const createTicketModal = document.getElementById('create-ticket-modal');
            if (createTicketModal) {
                createTicketModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.add('hidden');
                    }
                });
            }
            
            const autoRuleModal = document.getElementById('auto-rule-modal');
            if (autoRuleModal) {
                autoRuleModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.add('hidden');
                    }
                });
            }

            // 新增规则按钮
            const addRuleBtn = document.getElementById('add-rule-btn');
            if (addRuleBtn) {
                addRuleBtn.addEventListener('click', function() {
                    const modal = document.getElementById('add-rule-modal');
                    if (modal) {
                        modal.classList.remove('hidden');
                    }
                });
            }

            // 关闭新增规则弹窗
            const closeAddRuleModal = document.getElementById('close-add-rule-modal');
            if (closeAddRuleModal) {
                closeAddRuleModal.addEventListener('click', function() {
                    const modal = document.getElementById('add-rule-modal');
                    if (modal) {
                        modal.classList.add('hidden');
                    }
                });
            }

            const cancelAddRuleBtn = document.getElementById('cancel-add-rule-btn');
            if (cancelAddRuleBtn) {
                cancelAddRuleBtn.addEventListener('click', function() {
                    const modal = document.getElementById('add-rule-modal');
                    if (modal) {
                        modal.classList.add('hidden');
                    }
                });
            }

            // 保存规则
            const saveRuleBtn = document.getElementById('save-rule-btn');
            if (saveRuleBtn) {
                saveRuleBtn.addEventListener('click', function() {
                    // 这里可以添加保存规则的逻辑
                    alert('规则保存成功！');
                    const modal = document.getElementById('add-rule-modal');
                    if (modal) {
                        modal.classList.add('hidden');
                    }
                });
            }

            // 点击弹窗外部关闭弹窗
            const addRuleModal = document.getElementById('add-rule-modal');
            if (addRuleModal) {
                addRuleModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.add('hidden');
                    }
                });
            }
            
            // 触发类型切换事件
            const triggerTypeSelect = document.getElementById('trigger-type-select');
            if (triggerTypeSelect) {
                triggerTypeSelect.addEventListener('change', function() {
                    const alarmConditions = document.getElementById('alarm-conditions');
                    const scheduledConditions = document.getElementById('scheduled-conditions');
                    
                    if (this.value === 'alarm') {
                        // 显示告警触发条件，隐藏定时触发条件
                        alarmConditions.classList.remove('hidden');
                        scheduledConditions.classList.add('hidden');
                    } else if (this.value === 'scheduled') {
                        // 显示定时触发条件，隐藏告警触发条件
                        alarmConditions.classList.add('hidden');
                        scheduledConditions.classList.remove('hidden');
                    }
                });
            }
            
            // 定时触发周期类型切换事件
            const scheduleTypeSelect = document.getElementById('schedule-type');
            if (scheduleTypeSelect) {
                scheduleTypeSelect.addEventListener('change', function() {
                    const weeklyOption = document.getElementById('weekly-option');
                    const monthlyOption = document.getElementById('monthly-option');
                    const yearlyOption = document.getElementById('yearly-option');
                    
                    // 隐藏所有选项
                    weeklyOption.classList.add('hidden');
                    monthlyOption.classList.add('hidden');
                    yearlyOption.classList.add('hidden');
                    
                    // 根据所选值显示对应选项
                    if (this.value === 'weekly') {
                        weeklyOption.classList.remove('hidden');
                    } else if (this.value === 'monthly') {
                        monthlyOption.classList.remove('hidden');
                    } else if (this.value === 'yearly') {
                        yearlyOption.classList.remove('hidden');
                    }
                });
            }
        });
        
        // 响应式布局调整
        function adjustLayout() {
            const width = window.innerWidth;
            const contentContainer = document.querySelector('.content-container');
            const sidebar = document.getElementById('sidebar');
            
            if (contentContainer && sidebar) {
                if (width < 768) {
                    contentContainer.style.left = '0';
                    sidebar.classList.add('hidden');
                } else {
                    contentContainer.style.left = '240px';
                    sidebar.classList.remove('hidden');
                }
            }
        }
        
        // 工单详情弹窗
        function showTicketDetail(ticketId) {
            // 这里可以根据ticketId从后端获取详细信息
            // 为演示目的，这里使用静态数据和模拟不同状态
            const detailTicketId = document.getElementById('detail-ticket-id');
            const ticketDetailModal = document.getElementById('ticket-detail-modal');
            
            if (detailTicketId && ticketDetailModal) {
                detailTicketId.textContent = ticketId;
                
                // 根据工单ID模拟不同状态
                let ticketStatus = '';
                let ticketAssignee = '';
                
                // 模拟不同工单状态
                if (ticketId === 'TK-20230615-001') {
                    // 处理中状态
                    ticketStatus = '<span class="status-badge status-warning">处理中</span>';
                    ticketAssignee = '张工程师';
                    
                    // 显示处理中相关元素
                    showProcessingElements(ticketDetailModal);
                    
                } else if (ticketId === 'TK-20230615-002') {
                    // 待处理状态
                    ticketStatus = '<span class="status-badge status-info">待处理</span>';
                    ticketAssignee = '李工程师';
                    
                    // 显示待处理相关元素
                    showPendingElements(ticketDetailModal);
                    
                } else if (ticketId === 'TK-20230614-005' || ticketId === 'TK-20230614-003') {
                    // 已完成状态
                    ticketStatus = '<span class="status-badge status-normal">已完成</span>';
                    ticketAssignee = ticketId === 'TK-20230614-005' ? '王工程师' : '赵工程师';
                    
                    // 显示已完成相关元素
                    showCompletedElements(ticketDetailModal);
                    
                } else if (ticketId === 'TK-20230613-008') {
                    // 超时状态
                    ticketStatus = '<span class="status-badge status-critical">超时</span>';
                    ticketAssignee = '未分配';
                    
                    // 显示超时相关元素
                    showTimeoutElements(ticketDetailModal);
                }
                
                // 更新状态和处理人
                const statusElement = ticketDetailModal.querySelector('.ticket-status');
                const assigneeElement = ticketDetailModal.querySelector('.ticket-assignee');
                
                if (statusElement) statusElement.innerHTML = ticketStatus;
                if (assigneeElement) assigneeElement.textContent = ticketAssignee;
                
                // 显示弹窗
                ticketDetailModal.classList.remove('hidden');
            }
        }
        
        // 显示处理中状态的元素
        function showProcessingElements(modal) {
            // 隐藏所有状态特定元素
            hideAllStatusElements(modal);
            
            // 显示处理中状态的元素
            const processingRecords = modal.querySelectorAll('.processing-record');
            const processingActions = modal.querySelectorAll('.processing-actions');
            const submitBtn = modal.querySelector('.submit-btn');
            const completeBtn = modal.querySelector('.complete-btn');
            
            processingRecords.forEach(el => el.classList.remove('hidden'));
            processingActions.forEach(el => el.classList.remove('hidden'));
            
            if (submitBtn) submitBtn.classList.remove('hidden');
            if (completeBtn) completeBtn.classList.remove('hidden');
            
            // 设置状态选择器
            const statusSelect = modal.querySelector('.status-select');
            if (statusSelect) statusSelect.value = 'processing';
        }
        
        // 显示待处理状态的元素
        function showPendingElements(modal) {
            // 隐藏所有状态特定元素
            hideAllStatusElements(modal);
            
            // 显示待处理状态的元素
            const processingActions = modal.querySelectorAll('.processing-actions');
            const assignActions = modal.querySelector('.assign-actions');
            const assignBtn = modal.querySelector('.assign-btn');
            const startBtn = modal.querySelector('.start-btn');
            
            processingActions.forEach(el => el.classList.remove('hidden'));
            
            if (assignActions) assignActions.classList.remove('hidden');
            if (assignBtn) assignBtn.classList.remove('hidden');
            if (startBtn) startBtn.classList.remove('hidden');
            
            // 设置状态选择器
            const statusSelect = modal.querySelector('.status-select');
            if (statusSelect) statusSelect.value = 'pending';
        }
        
        // 显示已完成状态的元素
        function showCompletedElements(modal) {
            // 隐藏所有状态特定元素
            hideAllStatusElements(modal);
            
            // 显示已完成状态的元素
            const processingRecords = modal.querySelectorAll('.processing-record');
            const completedRecord = modal.querySelector('.completed-record');
            
            processingRecords.forEach(el => el.classList.remove('hidden'));
            if (completedRecord) completedRecord.classList.remove('hidden');
            
            // 隐藏处理操作
            const processingActions = modal.querySelectorAll('.processing-actions');
            processingActions.forEach(el => el.classList.add('hidden'));
        }
        
        // 显示超时状态的元素
        function showTimeoutElements(modal) {
            // 隐藏所有状态特定元素
            hideAllStatusElements(modal);
            
            // 显示超时状态的元素
            const assignActions = modal.querySelector('.assign-actions');
            const assignBtn = modal.querySelector('.assign-btn');
            
            if (assignActions) assignActions.classList.remove('hidden');
            if (assignBtn) assignBtn.classList.remove('hidden');
            
            // 设置状态选择器
            const statusSelect = modal.querySelector('.status-select');
            if (statusSelect) statusSelect.value = 'pending';
        }
        
        // 隐藏所有状态特定元素
        function hideAllStatusElements(modal) {
            // 使用安全的方式访问元素
            const processingRecords = modal.querySelectorAll('.processing-record');
            const completedRecord = modal.querySelector('.completed-record');
            const processingActions = modal.querySelectorAll('.processing-actions');
            const assignActions = modal.querySelector('.assign-actions');
            const assignBtn = modal.querySelector('.assign-btn');
            const startBtn = modal.querySelector('.start-btn');
            const submitBtn = modal.querySelector('.submit-btn');
            const completeBtn = modal.querySelector('.complete-btn');
            
            // 安全地添加hidden类
            processingRecords.forEach(el => el.classList.add('hidden'));
            if (completedRecord) completedRecord.classList.add('hidden');
            processingActions.forEach(el => el.classList.add('hidden'));
            if (assignActions) assignActions.classList.add('hidden');
            if (assignBtn) assignBtn.classList.add('hidden');
            if (startBtn) startBtn.classList.add('hidden');
            if (submitBtn) submitBtn.classList.add('hidden');
            if (completeBtn) completeBtn.classList.add('hidden');
        }
        
        // 初始化图表
        function initCharts() {
            // 工单趋势图
            const trendCtx = document.getElementById('ticketTrendChart');
            if (trendCtx) {
                new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: ['6/10', '6/11', '6/12', '6/13', '6/14', '6/15', '6/16'],
                        datasets: [
                            {
                                label: '待处理',
                                data: [3, 5, 4, 6, 5, 7, 4],
                                borderColor: 'rgb(59, 130, 246)',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.3,
                                fill: true
                            },
                            {
                                label: '处理中',
                                data: [2, 3, 5, 4, 6, 5, 3],
                                borderColor: 'rgb(245, 158, 11)',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                tension: 0.3,
                                fill: true
                            },
                            {
                                label: '已完成',
                                data: [1, 2, 3, 5, 4, 3, 2],
                                borderColor: 'rgb(16, 185, 129)',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                tension: 0.3,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    boxWidth: 6
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: false
                                }
                            },
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            }
                        }
                    }
                });
            }
            
            // 工单分类饼图
            const categoryCtx = document.getElementById('ticketCategoryChart');
            if (categoryCtx) {
                new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['设备故障', '系统维护', '巡检', '其他'],
                        datasets: [{
                            data: [42, 28, 18, 12],
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(245, 158, 11, 0.8)',
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(107, 114, 128, 0.8)'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    usePointStyle: true,
                                    boxWidth: 6
                                }
                            }
                        },
                        cutout: '70%'
                    }
                });
            }
        }
        
        // 页面加载和窗口大小变化时调整布局
        window.addEventListener('load', adjustLayout);
        window.addEventListener('resize', adjustLayout);
    </script>
</body>
</html>