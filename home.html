<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>站点管理 - 分布式储能系统</title>
    <!-- 
        注意: cdn.tailwindcss.com 不应在生产环境中使用。
        在生产环境中使用 Tailwind CSS，请将其安装为 PostCSS 插件或使用 Tailwind CLI。
        详情参考: https://tailwindcss.com/docs/installation
    -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&key=9e8264807bfc41a958e0d17aff56b146&plugin=AMap.ControlBar,AMap.ToolBar,AMap.Scale"></script>
    <style>
        /* 确保html和body可以滚动 */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: auto; /* 允许滚动 */
        }
        
        /* 主容器样式 */
        .main-container {
            min-height: 100vh; /* 至少占满视口高度 */
            position: relative;
            overflow-y: auto; /* 允许垂直滚动 */
        }
        
        /* 地图容器样式调整 */
        #map-container {
            position: fixed; /* 固定定位，不随页面滚动 */
            top: 64px; /* 顶部导航栏高度 */
            left: 240px; /* 侧边栏宽度 */
            right: 0;
            bottom: 0;
            z-index: 1;
        }
        
        /* 信息卡片覆盖层调整 */
        .dashboard-overlay {
            position: absolute; /* 绝对定位，随页面滚动 */
            top: 64px; /* 顶部导航栏高度 */
            left: 240px; /* 侧边栏宽度 */
            right: 0;
            bottom: 0;
            z-index: 10;
            pointer-events: none; /* 允许点击穿透到地图 */
            overflow-y: auto; /* 允许垂直滚动 */
            min-height: calc(100vh - 64px); /* 确保至少占满视口减去导航栏高度 */
        }
        
        /* 侧边栏调整 */
        aside {
            position: fixed; /* 固定定位，不随页面滚动 */
            top: 64px; /* 顶部导航栏高度 */
            left: 0;
            bottom: 0;
            width: 240px;
            overflow-y: auto; /* 允许垂直滚动 */
            z-index: 10;
        }
        
        /* 顶部导航栏调整 */
        header {
            position: fixed; /* 固定定位，不随页面滚动 */
            top: 0;
            left: 0;
            right: 0;
            height: 64px;
            z-index: 20;
        }
        
        /* 移动设备布局调整 */
        @media (max-width: 767px) {
            #map-container {
                left: 0; /* 在移动设备上隐藏侧边栏 */
            }
            
            .dashboard-overlay {
                left: 0;
                min-height: calc(100vh - 64px);
            }
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        .glass-card {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 12px;
        }
        .sidebar-item {
            transition: all 0.2s ease;
        }
        .sidebar-item:hover:not(.active) {
            background-color: rgba(243, 244, 246, 0.8);
        }
        .sidebar-item.active {
            background-color: rgba(219, 234, 254, 0.8);
            color: #3b82f6;
            border-left: 3px solid #3b82f6;
        }
        .chart-container {
            position: relative;
            height: 150px;
            width: 100%;
        }
        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .submenu.open {
            max-height: 200px;
        }
        
        /* 信息卡片覆盖层 */
        .dashboard-content {
            width: 100%;
            height: 100%;
            position: relative;
            pointer-events: none;
            padding: 16px;
            box-sizing: border-box;
        }
        
        /* 顶部信息卡片 */
        .top-info-card {
            position: absolute;
            top: 16px;
            left: 16px;
            right: 16px;
            pointer-events: auto;
            padding: 10px;
            max-height: 80px;
        }
        
        /* 左侧卡片区域 */
        .left-cards {
            position: absolute;
            top: 112px; /* 顶部卡片高度 + 间距 */
            left: 16px;
            width: 280px; /* 增加宽度从220px到280px */
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: auto;
            max-height: calc(100% - 128px);
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(148, 163, 184, 0.5) transparent;
            padding-right: 4px; /* 为滚动条留出空间 */
        }
        
        /* 右侧卡片区域 */
        .right-cards {
            position: absolute;
            top: 112px;
            right: 16px;
            width: 280px; /* 增加宽度从220px到280px */
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: auto;
            max-height: calc(100% - 128px);
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(148, 163, 184, 0.5) transparent;
            padding-right: 4px; /* 为滚动条留出空间 */
        }
        
        /* 自定义滚动条 */
        .left-cards::-webkit-scrollbar,
        .right-cards::-webkit-scrollbar {
            width: 4px;
        }
        
        .left-cards::-webkit-scrollbar-track,
        .right-cards::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .left-cards::-webkit-scrollbar-thumb,
        .right-cards::-webkit-scrollbar-thumb {
            background-color: rgba(203, 213, 225, 0.5);
            border-radius: 20px;
        }
        
        /* 卡片标题 */
        .card-title {
            font-size: 0.75rem; /* 12px */
            font-weight: 600;
            color: #1f2937; /* 更深的灰色 */
            text-transform: uppercase; /* 大写字母 */
            letter-spacing: 0.05em; /* 增加字母间距 */
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(229, 231, 235, 0.5); /* 添加底部边框 */
            display: flex;
            align-items: center;
        }
        
        /* 卡片标题图标 */
        .card-title i {
            margin-right: 0.375rem;
            color: #3b82f6; /* 蓝色图标 */
            font-size: 0.875rem; /* 14px */
        }
        
        /* 响应式布局 */
        @media (max-width: 1366px) {
            .left-cards,
            .right-cards {
                width: 240px; /* 在小屏幕上减小宽度，但仍比原来的大 */
            }
            
            .chart-container {
                height: 100px; /* 减小图表高度 */
            }
        }
        
        /* 平板设备布局 */
        @media (max-width: 1024px) and (min-width: 768px) {
            .left-cards,
            .right-cards {
                width: 220px; /* 在平板上进一步减小宽度 */
            }
            
            .chart-container {
                height: 90px; /* 进一步减小图表高度 */
            }
            
            /* 调整地图容器 */
            #map-container {
                left: 0; /* 在平板上隐藏侧边栏 */
            }
            
            /* 调整信息卡片覆盖层 */
            .dashboard-overlay {
                left: 0;
            }
            
            /* 显示侧边栏切换按钮 */
            .sidebar-toggle {
                display: block;
            }
            
            /* 侧边栏样式调整 */
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.show {
                transform: translateX(0);
            }
        }
        
        /* 超小屏幕设备布局 */
        @media (max-width: 480px) {
            /* 左侧卡片区域 */
            .left-cards {
                position: absolute;
                top: 112px;
                left: 16px;
                width: calc(100% - 32px); /* 宽度为全屏减去左右间距 */
                height: calc(50% - 112px - 16px); /* 高度为一半减去顶部卡片高度和间距 */
                max-height: none;
            }
            
            /* 右侧卡片区域 */
            .right-cards {
                position: absolute;
                top: calc(50% + 16px);
                left: 16px;
                right: 16px;
                width: calc(100% - 32px); /* 宽度为全屏减去左右间距 */
                height: calc(50% - 32px); /* 高度为一半减去间距 */
                max-height: none;
                
                /* 侧边栏切换按钮 */
                .sidebar-toggle {
                    display: none;
                    position: fixed;
                    top: 72px;
                    left: 16px;
                    z-index: 30;
                    background-color: rgba(255, 255, 255, 0.9);
                    border-radius: 50%;
                    width: 40px;
                    height: 40px;
                    text-align: center;
                    line-height: 40px;
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                    cursor: pointer;
                }
            }
        }

        /* 自定义滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(241, 245, 249, 0.6);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(148, 163, 184, 0.5);
            border-radius: 4px;
            transition: background 0.2s ease;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(148, 163, 184, 0.8);
        }
        
        /* Firefox滚动条样式 */
        * {
            scrollbar-width: thin;
            scrollbar-color: rgba(148, 163, 184, 0.5) rgba(241, 245, 249, 0.6);
        }
        
        /* 侧边栏滚动条 */
        .sidebar {
            scrollbar-width: thin;
            scrollbar-color: rgba(148, 163, 184, 0.5) transparent;
            overflow-y: auto;
        }
        
        /* 表格容器滚动条 */
        .table-container {
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(148, 163, 184, 0.5) transparent;
        }
        
        /* 侧边栏移动端自适应样式 */
        .mobile-sidebar {
            position: fixed;
            left: -240px;
            width: 240px;
            z-index: 50;
            transition: transform 0.3s ease-in-out;
            box-shadow: none;
        }
        
        .mobile-sidebar.show {
            transform: translateX(240px);
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.1);
        }
        
        /* 侧边栏切换按钮样式优化 */
        .sidebar-toggle {
            display: none;
            position: fixed;
            top: 72px;
            left: 12px;
            z-index: 30;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            width: 36px;
            height: 36px;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            border: 1px solid rgba(229, 231, 235, 0.5);
            transition: all 0.2s ease;
        }
        
        .sidebar-toggle:hover {
            background-color: rgba(255, 255, 255, 1);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }
        
        .sidebar-toggle i {
            color: #3b82f6;
            font-size: 18px;
        }
        
        /* 侧边栏内容样式优化 */
        .sidebar-item {
            border-radius: 8px;
            margin: 0 8px 4px 8px;
            transition: all 0.2s ease;
        }
        
        .sidebar-item:hover {
            background-color: rgba(243, 244, 246, 0.7);
        }
        
        .sidebar-item.active {
            background-color: rgba(219, 234, 254, 0.7);
        }
        
        .sidebar-item i {
            width: 20px;
            text-align: center;
        }
        
        /* 内容区域全宽样式 */
        .dashboard-overlay.full-width {
            width: calc(100% - 40px);
        }
        
        /* 增强移动端响应式样式 */
        @media (max-width: 768px) {
            .nav-item {
                padding: 0.5rem 0.75rem;
                font-size: 0.75rem;
            }
            
            .left-cards,
            .right-cards {
                width: calc(100% - 16px);
            }
            
            .card-title {
                font-size: 0.7rem;
            }
            
            /* 移动端侧边菜单显示时的遮罩层 */
            .sidebar-backdrop {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0, 0, 0, 0.3);
                z-index: 45;
            }
            
            .mobile-sidebar.show ~ .sidebar-backdrop {
                display: block;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="main-container" id="app">
        <!-- 顶部导航栏 -->
        <header class="bg-white shadow-sm fixed top-0 left-0 right-0 z-20">
            <div class="max-w-full mx-auto px-4">
                <div class="flex items-center justify-between h-16">
                    <!-- Logo 区域 - 替换为Bitower徽标 -->
                    <div class="flex-shrink-0 flex items-center pl-2 sm:pl-4 md:pl-6 lg:pl-8">
                        <!-- 使用Bitower徽标 -->
                        <img src="2.png" alt="Bitower" class="h-8 w-auto">
                    </div>
                    
                    <!-- 导航菜单 - 桌面版 -->
                    <div class="hidden md:flex md:items-center md:justify-center md:flex-1">
                        <nav class="flex flex-wrap justify-center space-x-1 sm:space-x-2 md:space-x-4 lg:space-x-10">
                            <a href="#" class="nav-item text-xs sm:text-sm font-medium py-1 px-1 border-b-2 border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300 transition-colors">
                                <span>驾驶舱</span>
                            </a>
                            <a href="#" class="nav-item active text-xs sm:text-sm font-medium py-1 px-1 border-b-2 border-blue-500 text-blue-500">
                                <span>站点列表</span>
                            </a>
                            <a href="#" class="nav-item text-xs sm:text-sm font-medium py-1 px-1 border-b-2 border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300 transition-colors">
                                <span>告警中心</span>
                            </a>
                            <a href="#" class="nav-item text-xs sm:text-sm font-medium py-1 px-1 border-b-2 border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300 transition-colors">
                                <span>消息通知</span>
                            </a>
                        </nav>
                    </div>
                    
                    <!-- 右侧图标区域 -->
                    <div class="hidden md:flex items-center space-x-4 pr-2 sm:pr-4 md:pr-6 lg:pr-8">
                        <a href="#" class="text-gray-600 hover:text-gray-900 transition-colors">
                            <i class="fas fa-cog text-lg"></i>
                            <span class="sr-only">管理</span>
                        </a>
                        <a href="#" class="text-gray-600 hover:text-gray-900 transition-colors">
                            <i class="fas fa-user-circle text-lg"></i>
                            <span class="sr-only">我的</span>
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- 左侧子导航菜单 -->
        <aside class="fixed left-0 top-16 bottom-0 w-60 bg-white shadow-sm z-10 overflow-y-auto">
            <nav class="py-4">
                <div class="sidebar-item active px-4 py-3 flex items-center space-x-3">
                    <i class="fas fa-home text-lg w-6"></i>
                    <span>站点概况</span>
                </div>
                
                <div class="sidebar-parent">
                    <div class="sidebar-item px-4 py-3 flex items-center justify-between cursor-pointer" id="battery-management">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-battery-three-quarters text-lg w-6"></i>
                            <span>电池管理</span>
                        </div>
                        <i class="fas fa-chevron-down text-sm transition-transform" id="battery-chevron"></i>
                    </div>
                    <div class="submenu pl-10" id="battery-submenu">
                        <div class="sidebar-item px-4 py-2 flex items-center space-x-3">
                            <i class="fas fa-bolt text-sm w-5"></i>
                            <span class="text-sm">PCS</span>
                        </div>
                        <div class="sidebar-item px-4 py-2 flex items-center space-x-3">
                            <i class="fas fa-box text-sm w-5"></i>
                            <span class="text-sm">电池柜</span>
                        </div>
                        <div class="sidebar-item px-4 py-2 flex items-center space-x-3">
                            <i class="fas fa-cubes text-sm w-5"></i>
                            <span class="text-sm">电池包</span>
                        </div>
                    </div>
                </div>
                
                <div class="sidebar-item px-4 py-3 flex items-center space-x-3">
                    <i class="fas fa-chart-line text-lg w-6"></i>
                    <span>收益报表</span>
                </div>
                
                <div class="sidebar-item px-4 py-3 flex items-center space-x-3">
                    <i class="fas fa-calendar-alt text-lg w-6"></i>
                    <span>业务调度日历</span>
                </div>
                
                <!--<div class="sidebar-item px-4 py-3 flex items-center space-x-3">
                    <i class="fas fa-charging-station text-lg w-6"></i>
                    <span>充放电策略</span>
                </div>-->
                
                <div class="sidebar-item px-4 py-3 flex items-center space-x-3">
                    <i class="fas fa-exclamation-triangle text-lg w-6"></i>
                    <span>站点报警</span>
                </div>
                
                <!--<div class="sidebar-item px-4 py-3 flex items-center space-x-3">
                    <i class="fas fa-chart-pie text-lg w-6"></i>
                    <span>分析报表</span>
                </div>-->
                
                <div class="sidebar-item px-4 py-3 flex items-center space-x-3">
                    <i class="fas fa-desktop text-lg w-6"></i>
                    <span>数据监控</span>
                </div>
            </nav>
        </aside>

        <!-- 侧边栏切换按钮 -->
        <div class="sidebar-toggle" @click="toggleSidebar">
            <i class="fas fa-bars"></i>
                </div>
                
        <!-- 移动端遮罩层 -->
        <div class="sidebar-backdrop" @click="toggleSidebar"></div>

        <!-- 主内容区域 -->
        <div id="map-container" class="fixed left-60 top-16 right-0 bottom-0 z-0">
            <!-- 地图容器 -->
                    </div>
                    
        <!-- 信息卡片覆盖层 -->
        <div class="dashboard-overlay fixed top-16 left-60 right-0 bottom-0 z-5 pointer-events-none">
            <!-- 覆盖层内容不变 -->
        </div>
    </div>

    <script>
        // 初始化3D地图
        document.addEventListener('DOMContentLoaded', function() {
            // 创建地图实例
            var map = new AMap.Map('map-container', {
                viewMode: '3D',  // 设置为3D视图模式
                zoom: 17,        // 设置地图缩放级别
                pitch: 50,       // 设置俯仰角度，使地图呈现3D效果
                center: [116.481964, 39.990633], // 北京朝阳区酒仙桥路坐标
                mapStyle: 'amap://styles/light',  // 使用浅色地图样式
                features: ['bg', 'building'], // 只显示背景和建筑，移除道路和标注
                buildingAnimation: true, // 开启建筑物动画效果
                skyColor: '#f0f8ff',  // 设置天空颜色
                dragEnable: true,    // 允许拖动地图以便调试
                zoomEnable: true,    // 允许缩放地图以便调试
                rotateEnable: false,  // 禁止旋转地图
                pitchEnable: false,   // 禁止改变俯仰角
                doubleClickZoom: false, // 禁止双击放大
                keyboardEnable: false,  // 禁止键盘控制
                scrollWheel: false,     // 禁止滚轮缩放
                touchZoom: false,       // 禁止触摸缩放
                showLabel: false,       // 隐藏文本标签
                showIndoorMap: false    // 隐藏室内地图
            });
            
            // 添加地图控件以便调试
            map.addControl(new AMap.ToolBar({
                position: 'RB'
            }));
            
            // 创建自定义站点图标
            var stationIcon = new AMap.Icon({
                // 使用更拟物化的图标
                image: 'https://a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-red.png',
                // 图标大小
                size: new AMap.Size(32, 32),
                // 图标相对于基点的偏移量
                imageOffset: new AMap.Pixel(0, 0),
                // 图标的锚点
                imageSize: new AMap.Size(32, 32)
            });
            
            // 添加站点标记
            var marker = new AMap.Marker({
                position: [116.481964, 39.990633],
                title: '北京朝阳储能电站',
                icon: stationIcon,
                anchor: 'bottom-center',
                offset: new AMap.Pixel(0, -16), // 调整图标位置
                zIndex: 100,
                // 添加脉冲动画效果
                animation: 'AMAP_ANIMATION_PULSE'
            });
            
            marker.setMap(map);
            
            // 创建信息窗体
            var infoWindow = new AMap.InfoWindow({
                isCustom: true,  // 使用自定义窗体
                content: createInfoContent(),
                offset: new AMap.Pixel(0, -40),
                autoMove: true,
                closeWhenClickMap: true
            });
            
            // 鼠标悬停在图标上显示信息窗体
            marker.on('mouseover', function() {
                infoWindow.open(map, marker.getPosition());
            });
            
            // 鼠标移出图标关闭信息窗体
            marker.on('mouseout', function() {
                infoWindow.close();
            });
            
            // 创建自定义信息窗体内容
            function createInfoContent() {
                var info = document.createElement('div');
                info.className = 'custom-info-window';
                
                // 设置信息窗体的样式
                info.style.cssText = 'background-color: rgba(255, 255, 255, 0.9); border-radius: 8px; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); padding: 12px; width: 280px; backdrop-filter: blur(10px);';
                
                // 添加电站信息
                info.innerHTML = `
                    <div style="border-bottom: 1px solid #eee; padding-bottom: 8px; margin-bottom: 8px;">
                        <h3 style="margin: 0; font-size: 14px; font-weight: 600; color: #1f2937;">北京朝阳储能电站</h3>
                        <p style="margin: 4px 0 0; font-size: 12px; color: #6b7280;">北京市朝阳区酒仙桥路10号</p>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <div>
                            <p style="margin: 0; font-size: 12px; color: #6b7280;">装机容量</p>
                            <p style="margin: 0; font-size: 14px; font-weight: 500; color: #1f2937;">10MW/20MWh</p>
                        </div>
                        <div>
                            <p style="margin: 0; font-size: 12px; color: #6b7280;">投运时间</p>
                            <p style="margin: 0; font-size: 14px; font-weight: 500; color: #1f2937;">2022-06-15</p>
                        </div>
                        <div>
                            <p style="margin: 0; font-size: 12px; color: #6b7280;">当前状态</p>
                            <p style="margin: 0; font-size: 14px; font-weight: 500; color: #10b981;">正常运行</p>
                        </div>
                        <div>
                            <p style="margin: 0; font-size: 12px; color: #6b7280;">今日收益</p>
                            <p style="margin: 0; font-size: 14px; font-weight: 500; color: #3b82f6;">¥2,586</p>
                        </div>
                    </div>
                `;
                
                return info;
            }
            
            // 使用Object3D API创建3D模型 - 注释这部分代码以避免错误
            /*
            try {
                // 确保Object3DLayer可用
                if (AMap.Object3DLayer) {
                    // 添加3D对象图层
                    var object3Dlayer = new AMap.Object3DLayer();
                    map.add(object3Dlayer);
                    
                    // 获取中心点坐标
                    var center = map.getCenter();
                    
                    // 创建一个简单的立方体代表储能站
                    var prism = new AMap.Object3D.Prism({
                        path: [
                            new AMap.LngLat(center.lng - 0.0002, center.lat - 0.0002),
                            new AMap.LngLat(center.lng + 0.0002, center.lat - 0.0002),
                            new AMap.LngLat(center.lng + 0.0002, center.lat + 0.0002),
                            new AMap.LngLat(center.lng - 0.0002, center.lat + 0.0002)
                        ],
                        height: 50,
                        color: '#3b82f6',
                        opacity: 0.8
                    });
                    
                    // 添加到图层
                    object3Dlayer.add(prism);
                    
                    // 添加屋顶
                    var roof = new AMap.Object3D.Prism({
                        path: [
                            new AMap.LngLat(center.lng - 0.00025, center.lat - 0.00025),
                            new AMap.LngLat(center.lng + 0.00025, center.lat - 0.00025),
                            new AMap.LngLat(center.lng + 0.00025, center.lat + 0.00025),
                            new AMap.LngLat(center.lng - 0.00025, center.lat + 0.00025)
                        ],
                        height: 10,
                        altitude: 50, // 在主体上方
                        color: '#1e40af',
                        opacity: 0.9
                    });
                    
                    // 添加到图层
                    object3Dlayer.add(roof);
                    
                    // 添加太阳能板
                    var solar = new AMap.Object3D.Prism({
                        path: [
                            new AMap.LngLat(center.lng - 0.00015, center.lat - 0.00015),
                            new AMap.LngLat(center.lng + 0.00015, center.lat - 0.00015),
                            new AMap.LngLat(center.lng + 0.00015, center.lat + 0.00015),
                            new AMap.LngLat(center.lng - 0.00015, center.lat + 0.00015)
                        ],
                        height: 5,
                        altitude: 60, // 在屋顶上方
                        color: '#0f172a',
                        opacity: 0.9
                    });
                    
                    // 添加到图层
                    object3Dlayer.add(solar);
                    
                    console.log('3D模型已添加');
                } else {
                    console.error('AMap.Object3DLayer 不可用');
                }
            } catch (e) {
                console.error('创建3D模型时出错:', e);
            }
            */
            
            // 调整地图视角，使模型可见
            map.setCenter([116.481964, 39.990633]);
            
            // 自定义地图样式，减少文字标签
            map.setMapStyle('amap://styles/light', {
                'labels': {
                    'visibleRoad': false,  // 隐藏道路名称
                    'visiblePoi': false,   // 隐藏兴趣点名称
                    'visibleDistrict': false // 隐藏行政区名称
                }
            });
            
            // 添加地图加载完成事件
            map.on('complete', function() {
                console.log('地图加载完成');
            });
        });
        
        // 调整布局函数
        function adjustLayout() {
            const windowWidth = window.innerWidth;
            const mapContainer = document.getElementById('map-container');
            const dashboardOverlay = document.querySelector('.dashboard-overlay');
            const sidebar = document.querySelector('aside');
            const sidebarToggle = document.querySelector('.sidebar-toggle');

            if (!mapContainer || !dashboardOverlay || !sidebar) {
                console.warn('某些DOM元素未找到，请检查HTML结构');
                return;
            }

            if (windowWidth <= 1024) {
                // 平板和移动设备布局
                mapContainer.style.left = '0';
                dashboardOverlay.style.left = '0';
                sidebar.classList.remove('show');
                if (sidebarToggle) sidebarToggle.style.display = 'block';
            } else {
                // 桌面布局
                mapContainer.style.left = '240px';
                dashboardOverlay.style.left = '240px';
                if (sidebarToggle) sidebarToggle.style.display = 'none';
            }
        }

        // 侧边栏切换函数
        function toggleSidebar() {
            const sidebar = document.querySelector('aside');
            if (sidebar) {
                sidebar.classList.toggle('show');
            }
        }
        
        // 初始化时调整布局
        document.addEventListener('DOMContentLoaded', function() {
            adjustLayout();
            
            // 初始化图表
            const powerCtx = document.getElementById('powerChart');
            const incomeCtx = document.getElementById('incomeChart');

            if (powerCtx && incomeCtx) {
                // 初始化充放电曲线图表
                new Chart(powerCtx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['8/9', '8/10', '8/11', '8/12', '8/13', '8/14', '8/15'],
                    datasets: [{
                            label: '充电量',
                            data: [42.5, 44.2, 40.8, 46.3, 43.1, 41.9, 45.6],
                        borderColor: 'rgba(59, 130, 246, 0.8)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: false,
                        pointRadius: 2
                    }, {
                            label: '放电量',
                            data: [35.7, 37.1, 34.3, 38.9, 36.2, 35.2, 38.2],
                        borderColor: 'rgba(16, 185, 129, 0.8)',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: false,
                        pointRadius: 2
                    }, {
                            label: '循环效率',
                            data: [84.0, 83.9, 84.1, 84.0, 84.0, 84.0, 83.8],
                            borderColor: 'rgba(156, 163, 175, 0.8)',
                            backgroundColor: 'rgba(156, 163, 175, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: false,
                            pointRadius: 2,
                            yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#1f2937',
                            bodyColor: '#4b5563',
                            borderColor: 'rgba(229, 231, 235, 1)',
                            borderWidth: 1,
                            padding: 8,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                        var label = context.dataset.label;
                                        var value = context.raw;
                                        if (label === '循环效率') {
                                            return label + ': ' + value.toFixed(1) + '%';
                                        } else {
                                            return label + ': ' + value.toFixed(1) + 'MWh';
                                        }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 8
                                },
                                color: '#9ca3af'
                            }
                        },
                        y: {
                                position: 'left',
                            grid: {
                                color: 'rgba(243, 244, 246, 0.5)'
                            },
                            ticks: {
                                font: {
                                    size: 8
                                },
                                color: '#9ca3af',
                                callback: function(value) {
                                        return value + 'MWh';
                                    }
                                }
                            },
                            y1: {
                                position: 'right',
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    font: {
                                        size: 8
                                    },
                                    color: '#9ca3af',
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                },
                                min: 80,
                                max: 90
                        }
                    }
                }
            });
            
                // 初始化收益曲线图表
                new Chart(incomeCtx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['8/9', '8/10', '8/11', '8/12', '8/13', '8/14', '8/15'],
                    datasets: [{
                            label: '总收益',
                            data: [2350, 2420, 2280, 2510, 2374, 2298, 2586],
                        borderColor: 'rgba(59, 130, 246, 0.8)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: false,
                        pointRadius: 2
                    }, {
                            label: '峰谷价差',
                            data: [1175, 1210, 1140, 1255, 1187, 1149, 1293],
                        borderColor: 'rgba(16, 185, 129, 0.8)',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: false,
                        pointRadius: 2
                    }, {
                            label: '辅助服务',
                            data: [1175, 1210, 1140, 1255, 1187, 1149, 1293],
                            borderColor: 'rgba(139, 92, 246, 0.8)',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: false,
                            pointRadius: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#1f2937',
                            bodyColor: '#4b5563',
                            borderColor: 'rgba(229, 231, 235, 1)',
                            borderWidth: 1,
                            padding: 8,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                        return context.dataset.label + ': ¥' + context.raw.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 8
                                },
                                color: '#9ca3af'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(243, 244, 246, 0.5)'
                            },
                            ticks: {
                                font: {
                                    size: 8
                                },
                                color: '#9ca3af',
                                callback: function(value) {
                                        return '¥' + value;
                                    }
                                }
                        }
                    }
                }
            });
        }

        // 为移动设备创建图表
            const mobilePowerCtx = document.getElementById('mobilePowerChart');
            const mobileIncomeCtx = document.getElementById('mobileIncomeChart');
            
            if (mobilePowerCtx) {
            // 移动设备充放电曲线图表
                new Chart(mobilePowerCtx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['6月10日', '6月11日', '6月12日', '6月13日', '6月14日', '6月15日', '6月16日'],
                    datasets: [{
                        label: '充电量',
                        data: [42.5, 44.2, 40.8, 46.3, 43.1, 41.9, 45.6],
                        borderColor: 'rgba(59, 130, 246, 0.8)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: false,
                        pointRadius: 2
                    }, {
                        label: '放电量',
                        data: [35.7, 37.1, 34.3, 38.9, 36.2, 35.2, 38.2],
                        borderColor: 'rgba(16, 185, 129, 0.8)',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: false,
                        pointRadius: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 8
                                },
                                color: '#9ca3af'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(243, 244, 246, 0.5)'
                            },
                            ticks: {
                                font: {
                                    size: 8
                                },
                                color: '#9ca3af'
                            }
                        }
                    }
                }
            });
            }
            
            if (mobileIncomeCtx) {
            // 移动设备收益曲线图表
                new Chart(mobileIncomeCtx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['6月10日', '6月11日', '6月12日', '6月13日', '6月14日', '6月15日', '6月16日'],
                    datasets: [{
                        label: '总收益',
                        data: [2345, 2156, 2678, 2432, 2789, 2567, 2586],
                        borderColor: 'rgba(59, 130, 246, 0.8)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: false,
                        pointRadius: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 8
                                },
                                color: '#9ca3af'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(243, 244, 246, 0.5)'
                            },
                            ticks: {
                                font: {
                                    size: 8
                                },
                                color: '#9ca3af',
                                callback: function(value) {
                                    return '¥' + value;
                                }
                            }
                        }
                    }
                }
            });
            }
        });

        // 监听窗口大小变化
        window.addEventListener('resize', adjustLayout);
    </script>
</body>
</html>